@model CursosLibrary.ModuloCursosUbicacioDetallesViewModel

@{
    Layout = "~/Views/Shared/Modulo-Cursos/_Cursos-Ubicaciones.cshtml";
    ViewData["Title"] = "Ubicación";
    ViewData["Title-Bloque-1"] = "Ubicación";
    ViewData["Message"] = "CMS - Gaolos App v2017";
}

<div class="main-content m-0" id="widget-area">

    <div class="container-fluid">
        <div class="row">
            <div class="col-12 header-section">
                <h2>@ViewData["Title"]</h2>
                @Html.Raw(ViewData["Migas"])
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <div class="col-12">

                @if (Model.Model.Err.eserror)
                {
                    ViewData["err"] = Model.Model.Err.mensaje;
                    @Html.Partial("AccesoDenegado");
                }
                else
                {

                <div class="card mb-3">


                    <div class="card-header card-header-options">
                        <span>Ubicación: @Model.Model.Ubi</span>
                        <div class="card-actions">
                            <ul>
                                <li><a href="#" class="handle"><i class="fa fa-bars"></i></a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="card-block p-0">
                        <div class="d-flex justify-content-center align-items-center">
                            <div class="col-1 pb-2 pt-2">
                                <img src="~/flaticons/placeholder.svg" style="width: 100%">
                            </div>
                            <div class="col-11 pt-2 pb-2 box-border-left-light">
                                <h5 class="fw-5">@Model.Model.Ubi</h5>
                                <p class="fw-5">@Model.Model.Pro</p>

                                <div class="d-flex">
                                    <div class="box-grey-bg">
                                        <p class="mb-0"><small class="fw-5"><span class="mr-1">Nº:</span> <span class="text-danger">@Model.Model.ID_Ubi2</span></small></p>
                                        <p class="mb-0"><small class="fw-5"><span class="mr-1">Usuario:</span> <span class="text-danger">@Model.Model.Usu</span></small><input type="hidden" id="ID_Curso2" value="sdsd" /></p>
                                        <p class="mb-0"><small class="fw-5"><span class="mr-1">Fecha de creación:</span> <span class="text-danger">@Model.Model.Fe_Al</span></small></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                    @* Editar ubicación *@

                    <div class="row">
                        <div class="col-12">

                            <div class="card mb-3">
                                <div class="card-header card-header-options">
                                    <span>Editar ubicación</span>
                                    <div class="card-actions">
                                        <ul>
                                            <li><a href="#" class="handle"><i class="fa fa-bars"></i></a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="card-block">
                                    <div class="card-block">
                                        <div class="form-group">
                                            <label for="cliente">Ubicación</label>
                                            <input type="text" class="form-control" id="Ubi" placeholder="Ubicación" autocomplete="off" value="@Model.Model.Ubi">
                                            <input type="hidden" id="ID_Ubi2" value="@Model.Model.ID_Ubi2">
                                        </div>
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <label for="Tipo">Tipo</label>
                                                    <select class="form-control" id="ID_TipoUbi">
                                                        @if (Model.Model.TipoUbi != null)
                                                        {
                                                            for (Int32 t = 0; t < Model.Model.TipoUbi.Length; t++)
                                                            {
                                                                string opt = "<option value='" + Model.Model.TipoUbi[t].id + "'";
                                                                if (Model.Model.TipoUbi[t].id == Model.Model.ID_TipoUbi) { opt += " selected "; }
                                                                opt += ">" + Model.Model.TipoUbi[t].det + "</option>";
                                                                @Html.Raw(opt)
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <label for="codigo">Código</label>
                                                    <input type="text" class="form-control" id="Codigo" placeholder="Código" value="@Model.Model.Codigo">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <label for="observaciones">Observaciones</label>
                                                    <textarea class="form-control" id="Obs" rows="3" placeholder="Observaciones">@Model.Model.Obs</textarea>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <label for="contactos">Contactos</label>
                                                    <textarea class="form-control" id="Contacto" rows="3" placeholder="Contacto">@Model.Model.Contacto</textarea>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-12">
                                                <div class="form-group">
                                                    <div class="d-flex align-items-center">
                                                        <label for="direccion mb-0">Dirección</label>
                                                        <a href="#" class="btn btn-secondary btn-sm fw-5 ml-3 mb-2" data-container="body" data-toggle="popover" data-placement="top" data-content="Para una Geolocalización correcta, en dirección, lo primero es el nombre de la calle y el número sin comas. Lo que se ponga despues de la coma, no será interpretado para la Geolocalización. Anotaciones , polígonos, etc ... , siempre despues de la coma." data-original-title="" title="" aria-describedby="popover710271"><i class="fa fa-question"></i></a>
                                                    </div>
                                                     
                                                    <textarea class="form-control" id="Dir" rows="3" placeholder="Dirección">@Model.Model.Dir</textarea>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <label for="Tipo">País</label>
                                                    <select class="form-control cambio-pais" id="UbiPai_1">
                                                        @if (Model.Model.Pais != null)
                                                        {
                                                            for (Int32 t = 0; t < Model.Model.Pais.Length; t++)
                                                            {
                                                                string opt = "<option value='" + Model.Model.Pais[t].det + "'";
                                                                if (Model.Model.Pais[t].det == Model.Model.Pai) { opt += " selected "; }
                                                                opt += ">" + Model.Model.Pais[t].det + "</option>";
                                                                @Html.Raw(opt)
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <label for="provincia">Provincia</label>
                                                    <select class="form-control cambio-provincia" id="UbiPro_1">
                                                        @if (Model.Model.Pros != null)
                                                        {
                                                            for (Int32 t = 0; t < Model.Model.Pros.Length; t++)
                                                            {
                                                                string opt = "<option value='" + Model.Model.Pros[t].det + "'";
                                                                if (Model.Model.Pros[t].det == Model.Model.Pro) { opt += " selected "; }
                                                                opt += ">" + Model.Model.Pros[t].det + "</option>";
                                                                @Html.Raw(opt)
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <label for="cpostal">Código Postal</label>
                                                    <select class="form-control cambio-cp" id="UbiCP_1">
                                                        @if (Model.Model.CPs != null)
                                                        {
                                                            for (Int32 t = 0; t < Model.Model.CPs.Length; t++)
                                                            {
                                                                string opt = "<option value='" + Model.Model.CPs[t].det + "'";
                                                                if (Model.Model.CPs[t].det == Model.Model.CP) { opt += " selected "; }
                                                                opt += ">" + Model.Model.CPs[t].det + "</option>";
                                                                @Html.Raw(opt)
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <label for="poblacion">Población</label>
                                                    <select class="form-control" id="UbiPob_1">
                                                        @if (Model.Model.Pobs != null)
                                                        {
                                                            for (Int32 t = 0; t < Model.Model.Pobs.Length; t++)
                                                            {
                                                                string opt = "<option value='" + Model.Model.Pobs[t].det + "'";
                                                                if (Model.Model.Pobs[t].det == Model.Model.Pob) { opt += " selected "; }
                                                                opt += ">" + Model.Model.Pobs[t].det + "</option>";
                                                                @Html.Raw(opt)
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-12">
                                                <div class="form-group">
                                                    <label class="custom-control custom-checkbox mb-2 mt-2">
                                                        @{
                                                            string str = "";
                                                            if (Model.Model.EnWeb) { str = " checked "; }
                                                        }
                                                        <input type="checkbox" class="custom-control-input" @Html.Raw(str) id="EnWeb">
                                                        
                                                        <span class="custom-control-label">Ver en web</span>
                                                    </label>
                                                </div>

                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <label for="latitud">Latitud</label>
                                                    <input type="text" class="form-control" id="Lat" placeholder="Latitud" value="@Model.Model.Latitud">
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <label for="longitud">Longitud</label>
                                                    <div class="input-group card-search-box mb-3">
                                                        <input type="text" class="form-control" id="Lng" placeholder="Longitud" value="@Model.Model.Longitud">
                                                        <span class="input-group-append">
                                                            <button class="btn btn-primary get-geo" type="submit"><i class="fa fa-map-marker"></i> Geolocalizar</button>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                        <div class="row px-3 mt-3">
                                            <div id="rutas-map" class="map-inner"></div>
                                        </div>



                                        <div class="form-group text-center mt-4 mb-0">
                                            <button type="button" class="btn btn-primary btn-sm cursos-guardar-ubicacion">Guardar</button>
                                        </div>

                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="row">
                        <div class="col-6">
                            <div class="card mb-3">
                                <div class="card-header card-header-options">
                                    <span>Añadir etiquetas</span>



                                    <div class="card-actions">
                                        <ul>
                                            <li><a href="#" class="handle"><i class="fa fa-bars"></i></a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="card-block">

                                    <div class="form-group text-center px-3">

                                        <div class="input-group input-group-sm ui-widget">
                                            <input type="text" class="form-control ui-autocomplete-input" value="" placeholder="Buscar etiquetas" id="" name="" autocomplete="off">
                                            <input id="" name="" type="hidden" value="0"><input id="" name="" type="hidden" value="">
                                            <span class="input-group-append">
                                                <button class="btn btn-primary vfindcarac" id="" type="button">Añadir</button>
                                            </span>
                                        </div>
                                        <div class="mt-3 mb-0">
                                            <span class="badge badge-pill badge-default p-2 mt-1"><i class="fa fa-tag ml-1 mr-1"></i> <a href="#" class="fw-5"> Operador Maquinaria</a> <a href="#" class="tag-del"><i class="fa fa-times"></i></a></span>
                                            <span class="badge badge-pill badge-default p-2 mt-1"><i class="fa fa-tag ml-1 mr-1"></i> <a href="#" class="fw-5"> Etiqueta</a> <a href="#" class="tag-del"><i class="fa fa-times"></i></a></span>
                                            <span class="badge badge-pill badge-default p-2 mt-1"><i class="fa fa-tag ml-1 mr-1"></i> <a href="#" class="fw-5"> Otra</a> <a href="#" class="tag-del"><i class="fa fa-times"></i></a></span>
                                            <span class="badge badge-pill badge-default p-2 mt-1"><i class="fa fa-tag ml-1 mr-1"></i> <a href="#" class="fw-5"> Operador Maquinaria</a> <a href="#" class="tag-del"><i class="fa fa-times"></i></a></span>
                                        </div>


                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card card-table mb-3">
                                <div class="card-header card-header-options">
                                    <span>Documentos</span>
                                    <div class="input-group input-group-sm col-5 mr-0 px-0">
                                        <input type="text" class="form-control" value="" placeholder="Documento público" id="findcarac1" name="findcarac1">
                                        <input id="vfindcarac1" name="vfindcarac1" type="hidden" value="" /><input id="tfindcarac1" name="tfindcarac1" type="hidden" value="" />
                                        <div class="input-group-append">
                                            <button type="button" class="btn btn-primary btn-sm cursos-vincular-doc-ubi">Vincular</button>
                                        </div>
                                    </div>

                                </div>
                                <div class="card-block">
                                    <table class="table table-striped table-select">
                                        <thead>
                                            <tr>
                                                <th>Documento</th>
                                                <th class="w-10 text-center">Desvincular</th>
                                            </tr>
                                        </thead>
                                        <tbody id="DocRel"></tbody>
                                    </table>
                                </div>
                            </div>


                            <div class="card mb-3">
                                <div class="card-header card-header-options">
                                    <span>Enviar ubicación por mail</span>
                                </div>
                                <div class="card-block">
                                    <div class="input-group input-group-sm ui-widget">
                                        <input type="text" class="form-control form-control-sm" value="" placeholder="Enviar ubicación por mail" id="" name="" autocomplete="off">
                                        <input id="" name="" type="hidden" value="0"><input id="" name="" type="hidden" value="">
                                        <span class="input-group-append">
                                            <button class="btn btn-primary vfindcarac" id="" type="button">Enviar</button>
                                        </span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
           }
            </div>
        </div>

    </div>

</div>

<script>
    CursosUbiDocsRels(@Model.Model.ID_Ubi2, 'DocRel');
</script>

<script>

    var map;

    function initMap() {

        var ubi = document.getElementById("Ubi").value;
        var lat = parseFloat(document.getElementById("Lat").value);
        var lng = parseFloat(document.getElementById("Lng").value);

        if (lat == "" || lng == "") {
            return;
        }


        var centro = {  lat: lat, lng: lng };

        map = new google.maps.Map(document.getElementById('rutas-map'), {
            zoom: 16,
            //center: new google.maps.LatLng(-33.92, 151.25),
            center: centro,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        var infowindow = new google.maps.InfoWindow();

        var marker, i;
        var markers = [];

        var locations = [[ubi, lat, lng, 4]];

        for (i = 0; i < locations.length; i++) {
            marker = new google.maps.Marker({
                position: new google.maps.LatLng(locations[i][1], locations[i][2]),
                map: map
            });

            markers.push(marker);

            google.maps.event.addListener(marker, 'click', (function (marker, i) {
                return function () {
                    infowindow.setContent(locations[i][0]);
                    infowindow.open(map, marker);
                }
            })(marker, i));
        }

        var trafficLayer = new google.maps.TrafficLayer();
        trafficLayer.setMap(map);

        //console.log(markers[0]);

    }
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDp_XTA4o-Cd-BBZIgqGc4EDno6sbgsIaI&callback=initMap"></script>
